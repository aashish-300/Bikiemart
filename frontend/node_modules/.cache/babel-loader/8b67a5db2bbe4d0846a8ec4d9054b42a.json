{"ast":null,"code":"'use strict';\n\nvar _classCallCheck = require(\"D:/fyp/Ecommerce_Bikiemart/frontend/node_modules/@babel/runtime/helpers/classCallCheck.js\").default;\nvar _createClass = require(\"D:/fyp/Ecommerce_Bikiemart/frontend/node_modules/@babel/runtime/helpers/createClass.js\").default;\nvar packageData = require('../../package.json');\nvar shared = require('../shared');\n\n/**\n * Generates a Transport object for streaming\n *\n * Possible options can be the following:\n *\n *  * **buffer** if true, then returns the message as a Buffer object instead of a stream\n *  * **newline** either 'windows' or 'unix'\n *\n * @constructor\n * @param {Object} optional config parameter\n */\nvar StreamTransport = /*#__PURE__*/function () {\n  function StreamTransport(options) {\n    _classCallCheck(this, StreamTransport);\n    options = options || {};\n    this.options = options || {};\n    this.name = 'StreamTransport';\n    this.version = packageData.version;\n    this.logger = shared.getLogger(this.options, {\n      component: this.options.component || 'stream-transport'\n    });\n    this.winbreak = ['win', 'windows', 'dos', '\\r\\n'].includes((options.newline || '').toString().toLowerCase());\n  }\n\n  /**\n   * Compiles a mailcomposer message and forwards it to handler that sends it\n   *\n   * @param {Object} emailMessage MailComposer object\n   * @param {Function} callback Callback function to run when the sending is completed\n   */\n  _createClass(StreamTransport, [{\n    key: \"send\",\n    value: function send(mail, done) {\n      var _this = this;\n      // We probably need this in the output\n      mail.message.keepBcc = true;\n      var envelope = mail.data.envelope || mail.message.getEnvelope();\n      var messageId = mail.message.messageId();\n      var recipients = [].concat(envelope.to || []);\n      if (recipients.length > 3) {\n        recipients.push('...and ' + recipients.splice(2).length + ' more');\n      }\n      this.logger.info({\n        tnx: 'send',\n        messageId: messageId\n      }, 'Sending message %s to <%s> using %s line breaks', messageId, recipients.join(', '), this.winbreak ? '<CR><LF>' : '<LF>');\n      setImmediate(function () {\n        var stream;\n        try {\n          stream = mail.message.createReadStream();\n        } catch (E) {\n          _this.logger.error({\n            err: E,\n            tnx: 'send',\n            messageId: messageId\n          }, 'Creating send stream failed for %s. %s', messageId, E.message);\n          return done(E);\n        }\n        if (!_this.options.buffer) {\n          stream.once('error', function (err) {\n            _this.logger.error({\n              err: err,\n              tnx: 'send',\n              messageId: messageId\n            }, 'Failed creating message for %s. %s', messageId, err.message);\n          });\n          return done(null, {\n            envelope: mail.data.envelope || mail.message.getEnvelope(),\n            messageId: messageId,\n            message: stream\n          });\n        }\n        var chunks = [];\n        var chunklen = 0;\n        stream.on('readable', function () {\n          var chunk;\n          while ((chunk = stream.read()) !== null) {\n            chunks.push(chunk);\n            chunklen += chunk.length;\n          }\n        });\n        stream.once('error', function (err) {\n          _this.logger.error({\n            err: err,\n            tnx: 'send',\n            messageId: messageId\n          }, 'Failed creating message for %s. %s', messageId, err.message);\n          return done(err);\n        });\n        stream.on('end', function () {\n          return done(null, {\n            envelope: mail.data.envelope || mail.message.getEnvelope(),\n            messageId: messageId,\n            message: Buffer.concat(chunks, chunklen)\n          });\n        });\n      });\n    }\n  }]);\n  return StreamTransport;\n}();\nmodule.exports = StreamTransport;","map":{"version":3,"names":["packageData","require","shared","StreamTransport","options","name","version","logger","getLogger","component","winbreak","includes","newline","toString","toLowerCase","mail","done","message","keepBcc","envelope","data","getEnvelope","messageId","recipients","concat","to","length","push","splice","info","tnx","join","setImmediate","stream","createReadStream","E","error","err","buffer","once","chunks","chunklen","on","chunk","read","Buffer","module","exports"],"sources":["D:/fyp/Ecommerce_Bikiemart/frontend/node_modules/nodemailer/lib/stream-transport/index.js"],"sourcesContent":["'use strict';\n\nconst packageData = require('../../package.json');\nconst shared = require('../shared');\n\n/**\n * Generates a Transport object for streaming\n *\n * Possible options can be the following:\n *\n *  * **buffer** if true, then returns the message as a Buffer object instead of a stream\n *  * **newline** either 'windows' or 'unix'\n *\n * @constructor\n * @param {Object} optional config parameter\n */\nclass StreamTransport {\n    constructor(options) {\n        options = options || {};\n\n        this.options = options || {};\n\n        this.name = 'StreamTransport';\n        this.version = packageData.version;\n\n        this.logger = shared.getLogger(this.options, {\n            component: this.options.component || 'stream-transport'\n        });\n\n        this.winbreak = ['win', 'windows', 'dos', '\\r\\n'].includes((options.newline || '').toString().toLowerCase());\n    }\n\n    /**\n     * Compiles a mailcomposer message and forwards it to handler that sends it\n     *\n     * @param {Object} emailMessage MailComposer object\n     * @param {Function} callback Callback function to run when the sending is completed\n     */\n    send(mail, done) {\n        // We probably need this in the output\n        mail.message.keepBcc = true;\n\n        let envelope = mail.data.envelope || mail.message.getEnvelope();\n        let messageId = mail.message.messageId();\n\n        let recipients = [].concat(envelope.to || []);\n        if (recipients.length > 3) {\n            recipients.push('...and ' + recipients.splice(2).length + ' more');\n        }\n        this.logger.info(\n            {\n                tnx: 'send',\n                messageId\n            },\n            'Sending message %s to <%s> using %s line breaks',\n            messageId,\n            recipients.join(', '),\n            this.winbreak ? '<CR><LF>' : '<LF>'\n        );\n\n        setImmediate(() => {\n            let stream;\n\n            try {\n                stream = mail.message.createReadStream();\n            } catch (E) {\n                this.logger.error(\n                    {\n                        err: E,\n                        tnx: 'send',\n                        messageId\n                    },\n                    'Creating send stream failed for %s. %s',\n                    messageId,\n                    E.message\n                );\n                return done(E);\n            }\n\n            if (!this.options.buffer) {\n                stream.once('error', err => {\n                    this.logger.error(\n                        {\n                            err,\n                            tnx: 'send',\n                            messageId\n                        },\n                        'Failed creating message for %s. %s',\n                        messageId,\n                        err.message\n                    );\n                });\n                return done(null, {\n                    envelope: mail.data.envelope || mail.message.getEnvelope(),\n                    messageId,\n                    message: stream\n                });\n            }\n\n            let chunks = [];\n            let chunklen = 0;\n            stream.on('readable', () => {\n                let chunk;\n                while ((chunk = stream.read()) !== null) {\n                    chunks.push(chunk);\n                    chunklen += chunk.length;\n                }\n            });\n\n            stream.once('error', err => {\n                this.logger.error(\n                    {\n                        err,\n                        tnx: 'send',\n                        messageId\n                    },\n                    'Failed creating message for %s. %s',\n                    messageId,\n                    err.message\n                );\n                return done(err);\n            });\n\n            stream.on('end', () =>\n                done(null, {\n                    envelope: mail.data.envelope || mail.message.getEnvelope(),\n                    messageId,\n                    message: Buffer.concat(chunks, chunklen)\n                })\n            );\n        });\n    }\n}\n\nmodule.exports = StreamTransport;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}